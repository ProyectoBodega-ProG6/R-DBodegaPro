<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title>Crear Entrada/Salida</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<section layout:fragment="content" class="container mt-4">

    <h2 class="mb-4">Registrar Movimiento</h2>

    <!-- Mensajes de Ã©xito o error -->
    <div th:if="${msg}" class="alert alert-success" th:text="${msg}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <form th:action="@{/movimientos/save}" th:object="${movimiento}" method="post" class="needs-validation">

        <!-- Producto -->
        <div class="mb-3">
            <label class="form-label">Producto</label>
            <select th:field="*{producto.id}" class="form-select">
                <option th:each="p : ${productos}"
                        th:value="${p.id}"
                        th:text="${p.nombre}">Producto</option>
            </select>
        </div>

        <!-- Tipo de movimiento -->
        <div class="mb-3">
            <label class="form-label">Tipo de Movimiento</label>
            <select th:field="*{tipoMovimiento.id}" class="form-select">
                <option th:each="t : ${tiposMovimiento}"
                        th:value="${t.id}"
                        th:text="${t.nombre}">Tipo</option>
            </select>
        </div>

        <!-- Cantidad -->
        <div class="mb-3">
            <label for="cantidad" class="form-label">Cantidad</label>
            <input type="number" th:field="*{cantidad}" id="cantidad" class="form-control" min="1" required>
        </div>

        <!-- Precio -->
        <div class="mb-3">
            <label>Precio</label>
            <input type="number" step="0.01"
                   th:field="*{precio}"
                   th:disabled="${movimiento.tipoMovimiento != null and movimiento.tipoMovimiento.tipo == 'Salida'}"
                   class="form-control"/>
            <small th:if="${movimiento.tipoMovimiento != null and movimiento.tipoMovimiento.tipo == 'Salida'}" class="text-muted">
                No editable para movimientos de salida
            </small>
        </div>

        <!-- Usuario -->
        <div class="mb-3">
            <label for="usuario">Usuario</label>
            <select th:field="*{usuario}" class="form-control" id="usuario">
                <option th:each="u : ${usuarios}" th:value="${u.id}" th:text="${u.nombreCompleto}"></option>
            </select>
            <div th:if="${#fields.hasErrors('usuario')}" th:errors="*{usuario}" class="text-danger"></div>
        </div>

        <!-- Fecha -->
        <div class="mb-3">
            <label class="form-label">Fecha</label>
            <input type="text" th:value="${movimiento.fechaStr}" readonly class="form-control"/>

        </div>

        <!-- Observaciones -->
        <div class="mb-3">
            <label for="observaciones" class="form-label">Observaciones</label>
            <textarea th:field="*{observaciones}" id="observaciones" class="form-control" rows="3"></textarea>
        </div>

        <!-- Botones -->
        <div class="d-flex justify-content-between">
            <a th:href="@{/movimientos}" class="btn btn-secondary">Cancelar</a>
            <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
    </form>
</section>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>