<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layouts/_mainLayout}">
<head>
  <title>Gestión de Usuarios</title>
</head>
<body>
<div layout:fragment="content">

  <h2 class="mb-4">Gestión de Usuarios</h2>

  <div th:if="${msg}" class="alert alert-success" th:text="${msg}"></div>
  <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

  <!-- Filtros -->
  <form th:action="@{/usuarios}" method="get" class="form-inline my-3">

  <div class="form-group mx-2">
    <label>Nombre Completo:</label>
    <input type="text" name="nombreCompleto" th:value="${nombreCompleto}" class="form-control" placeholder="Buscar por nombre">
  </div>

  <div class="form-group mx-2">
    <label>Username:</label>
    <input type="text" name="username" th:value="${username}" class="form-control" placeholder="Buscar por username">
  </div>

  <div class="form-group mx-2">
    <label>Rol:</label>
    <select name="nombreRol" class="form-control">
      <option value="">Todos</option>
      <option th:each="rol : ${roles}" th:value="${rol.nombreRol}"
              th:text="${rol.nombreRol}"
              th:selected="${rol.nombreRol == nombreRol}"></option>
    </select>
  </div>

    <div class="col-md-2 d-flex align-items-end gap-2">
    <button type="submit" class="btn btn-secondary mx-2">Buscar</button>
  <a th:href="@{/usuarios}" class="btn btn-light mx-2">Limpiar</a>
      <a th:href="@{/usuarios/create}" class="btn btn-primary mx-2">Nuevo</a>
    </div>

</form>


  <table class="table table-striped table-bordered">
    <thead>
    <tr>
      <th>ID</th>
      <th>Nombre Completo</th>
      <th>Username</th>
      <th>Correo</th>
      <th>Rol</th>
      <th>Status</th>
      <th>Acciones</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="usuario : ${usuarios.content}">
      <td th:text="${usuario.id}"></td>
      <td th:text="${usuario.nombreCompleto}"></td>
      <td th:text="${usuario.username}"></td>
      <td th:text="${usuario.correo_electronico}"></td>
      <td th:text="${usuario.rol.nombreRol}"></td>
      <td>
                <span th:text="${usuario.status == 1 ? 'Activo' : 'Inactivo'}"
                      th:classappend="${usuario.status == 1 ? 'text-success' : 'text-danger'}"></span>
      </td>
      <td>
        <a class="btn btn-info btn-sm" th:href="@{/usuarios/details/{id}(id=${usuario.id})}">Detalles</a>
        <a class="btn btn-warning btn-sm" th:href="@{/usuarios/edit/{id}(id=${usuario.id})}">Editar</a>
        <a class="btn btn-danger btn-sm"
           th:href="@{/usuarios/remove/{id}(id=${usuario.id})}">Eliminar</a>
      </td>
    </tr>
    </tbody>
  </table>

  <!-- Paginación -->
  <div th:if="${pageNumbers != null}">
    <ul class="pagination">
      <li class="page-item" th:each="i : ${pageNumbers}">
        <a class="page-link" th:href="@{/usuarios(page=${i},size=${usuarios.size},nombreCompleto=${nombreCompleto},username=${username},nombreRol=${nombreRol})}" th:text="${i}"></a>
      </li>
    </ul>
  </div>

</div>
</body>
</html>

